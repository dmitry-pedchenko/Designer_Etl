# Графический интерфейс загрузчика Easy Loader
## Описание приложения

Данное приложение выполнено в виде графического интерфейса, созданного для удобства использования системы загрузки.
Данное руководство служит как дополнение для основного руководства, которое находитися в файле `README_SYSTEM.md`. Описание настроек
системы и способы настроек находятся в основном руководстве, в данном файле находится только описание применения графического
интерфейса. Но отмечу, что ручное редактирование файла конфиграции излишне, при наличии данного интрфейса. Данная система
покрывает все необходимые функции работы.
## Оглавление

1. [Установка требуемых пакетов](#Установка-требуемых-пакетов)
2. [Информация о структуре проекта](#Информация-о-структуре-проекта)
3. [Сборка пакета в exe файл](#Сборка-пакета-в-exe-файл)
4. [Изменение языка системы](#Изменение-языка-системы)
5. [Запуск системы](#Запуск-системы)
6. [Описание загрузки](#Описание-загрузки)
7. [Открытие файла конфигурации](#Открытие-файла-конфигурации)
8. [Рабочие пространства и этапы создания файла конфигурации](#Рабочие-пространства-и-этапы-создания-файла-конфигурации)
9. [Создание файлов конфигурации загрузки данных](#Создание-файлов-конфигурации-загрузки-данных)
10. [Загрузка данных](#Загрузка-данных)
11. [Создание конфигурации сверки файлов и его запуск](#Создание-конфигурации-сверки-файлов-и-его-запуск)
12. [Создание конфигурации обновления данных](#Создание-конфигурации-обновления-данных)
13. [Закрытие проекта](#Закрытие-проекта)


## Установка требуемых пакетов

Для установки требуемых пакетов выполните в консоли следующие команды: 
```
pip install pyqt5
```
Версии пакетов на которых тестировалась система:

```
pandas 0.25.1
pymssql 2.1.4
mysql-connector-python 8.0.17
xlrd 1.2.0
pyqt5 5.13.0
```
[:arrow_up:Оглавление](#Оглавление)

## Информация о структуре проекта

В структуру проекта входят пакеты описанные ранне в основном файле описания системы, а так же новый пакет,
отвечающий за графическое оформление `GUI`
Он имеет следующую структуру:

- GUI
    - Creators
    - DAO
    - gui_qt
    - System
    - System
    - Trees
    - Windows
    - `gui_main_interface.py`
    
`Creators` В данном пакете находятся функции создания компонентов интерфейса
`DAO` в даном пакете находятся инструменты доступа к данным и создания файлов
`gui_qt` В данном пакете находятся файлы интерфейсов, созданные при помощи QT Desigener а также 
скрипты конвертирования их в файлы с расширением `.py`

`System` в данном пакете находятся файлы настроек системы. В частности настройка языка интерфейса
`Trees` в данном пакете находятся классы объектов интерфейса имеющие древесную структуру
`Windows` в данном пакете находятся объекты интерфейса представляющие собой окна программы.
`gui_main_interface.py` данный скрипт является основным скриптом запуска системы

[:arrow_up:Оглавление](#Оглавление)
## Сборка пакета в exe файл

ВАЖНО: сборка пакета под Windows осуществляется только из под ОС Windows

Для того чтобы появилась возможность запуска проекта из `.exe`файла нужно выполнить, находясь
в корневой директории следующее:

В файле `Core/Logger/Logger.py` в строке 184 строчку:

```python
if os.path.basename(sys.argv[0]) != 'gui_main_interface.py': 
```

нужно заменить на:

```python
if os.path.basename(sys.argv[0]) != 'gui_main_interface.exe': 
```

и затем, находясь в корневой директории, выполнить в командной строке следующее:

```bash
pyinstaller --noconsole --onefile --icon=icon.ico GUI/gui_main_interface.py
```

В результате появится директория dist, в которой находится собранный пакет 

`gui_main_interface.exe`

В директорию dist необходимо скопировать из директории `GUI` следующие диреткории вместе с содержимым:
- Source
- config
- System (только файлы `config.json` и `lan_config.xml` )
- log

т.е. папка с проектом будет выглядеть следующим образом

<image src="readme/open/dir.png">


Скачать уже собранный пакет можно по следующей <a href="https://drive.google.com/open?id=1GjOsarnXSuNWU5HI3GgS6LxWOl0IM_5B">ссылке</a>

[:arrow_up:Оглавление](#Оглавление)
## Изменение языка системы
 
Для изменения языка системы нужно выполнить следующее:

- Закрыть программу
- В файле `GUI/System/config.json` в разделе "language" значение поставить либо `sys` либо `rus`
- Открыть программу

Значение языка автоматически применится

`sys` устанавливает значения полей в системных переменных (как это описано в основном описании системы).

`rus` устанавливает язык интерфейса в русский язык.

По умолчанию стоит русский язык.

[:arrow_up:Оглавление](#Оглавление)
## Запуск системы

Для запуска системы нужно выполнить следующие действия:

- Находясь в коренвой директории в консоле выполнить
```bash
python GUI/gui_main_interface.py
```

Или, если собран пакет .exe , то запустить `gui_main_interface.exe`

[:arrow_up:Оглавление](#Оглавление)
## Описание загрузки

В данном руководстве будет выполнения следующая загрузка: в целевой таблице в базе данных 
MSSQL будет выполнена загрузка в три таблицы `Table_1` `Table_2` `Table`
Конфигурации таблиц следующие:

`Table_1`
<image src="readme/open/Table_1.png">


`Table_2`
<image src="readme/open/Table_2.png">


`Table`
<image src="readme/open/Table.png">

Таблицы `Table_1` и `Table_2` связаны с таблицей `Table` полями `Table_1.id` `Table_2.id` с полями
`Table.id_1` `Table.id_2` посредством внешних ключей 

В качестве источника имеется два Excel файла 

`loc_test_dic.xlsx`
<image src="readme/Load/loc_test_dic.png">

`Book.xlsx`
<image src="readme/Load/book.png">

Файл `Book.xlsx` служит для демонстрации операции сравнения двух файлов.
Если схематично изобразить какие поля из источника грузятся в таблицы базы данных то это будет иметь следующий вид:

<image src="readme/Load/loadpath.jpg">

[:arrow_up:Оглавление](#Оглавление)
## Открытие файла конфигурации

Для открытия файла нужно выполнить следующие действия:
В основном окне приложения открыть в верхней части раздел `File/Open` и в появившемся окне выбрать
нужный файл конфигурации. Во время открытия будет следующий вид программы:

<image src="readme/open/open_connect.png">

сообщающее о том что идет процесс открытия файла конфигурации.
Когда файл загрузится в систему, вы увидите следующий вид:

<image src="readme/open/opened.png">

Сообщеющий в нижней части окна о том к какой базе данных осуществлено подключение в соответствии с
настройками в конфигурации, а так же имя конфигурации, показанное в заголовке главного окна системы.

Данный процесс выглядит следующим образом:

<image src="readme/open/open_config.gif">

Если же процесс не может выполнится по каким-то причинам то будет отобрадено всплывающее окно с ошибкой:

<image src="readme/open/open_error.png">

Если ошибка появилась, то рекомендую проверить файл конфигурации на корректность имен полей, типов данных,и настроек базы данных
 открыв его любым текстовым редатором.
 Надо учесть то, что открытие файла конфигурации сопровождается подключением к базе данных, поэтому необходимо чтобы
 у машины на которой осуществляется работа с программой был доступ к базе данных. А также осуществляется
 открытие файла источника, поэтому нужно чтобы файл лежал в папке `Source`
 
 [:arrow_up:Оглавление](#Оглавление)
## Рабочие пространства и этапы создания файла конфигурации

Наодясь в главном окне приложения и зойдя в меню `View` в верхней части окна Вы увидите четыре раздела

- Loader
- DB conn editor
- Dictionary
- Config Editor

`Loader` этот раздел предназначен для осущствления загрузки данных в соответствии с заранее созданным
конфигом загрузки

`DB conn editor` этот раздел предназначен для редактирования в конфиге настроек подключения к базе данных. Открытие и
редактирование настроек осуществляется без подключения к базе данных. Что позволяет настроить неверно введенные данные.

`Dictionary` этот раздел предназначен для редактирования и настройки файла конфигурации для загрузки данных из базы данных.
Этими данными являются поля внешних ключей таблиц, которые находятся не в файле источнике, а автоматически создаются уже при
загрузке в самой базе данных.

`Config Editor` этот раздел предназначен для редактирования полей источника (находится слева в окне) и полей приемника данных 
(находится справа в окне). Этот раздел является основным и без него не обходится ни одно редактирование загрузки.

Разделы `Loader` и `DB conn editor` являются дополнительными и их можно открыть нажав на соответсвующий раздел в меню.
Разделы `Dictionary` и `Config Editor`открываются автоматически и их нельзя открыть нажав на их названия в меню.
Раздел `Dictionary` открывается только тогда когда осуществляется загрузка со словарной таблицей. А раздел 
`Config Editor` открывается всегда сразу автоматически при открытии файла конфигурации.

В меню `System` находится раздел `Configuration Wizard`. Этот раздел предназначен для создания новых файлов конфигурации.
Этот процесс состоит их шести этапов

- Настройки подключения к базе данных, а также выбор источника данных. Также в первом разделе можно настроить сравнение 
двух файлов источников. Также если поставить в чекбоксе `Со словарем`  галочку то будет осуществляться загрузка со словарем.
Нажав на кнопку далее осуществляется переход на следующую страницу, который сопровождается
подключением к базе данных и открытием файла источника.
- На втором окне нужно выбрать схему в которой находится целевая таблица, а также имя самой таблицы
- Далее предлагается выбрать из каких полей будет осуществляться загрузка данных. Нажава правой кнопкой мыши можно вызвать
контекстное меню загрузки где можно выбрать удалить или добавить новое поле. Также если выбрать в настройке поля меню 
замены значения, то также вызывается контектсное меню добавления или удаления данного этапа. Данное контекстное меню
вызывается также и в окне `Config Editor`
- В следующем окне предлагается настроить поля приемника. Эти поля создаются автоматически изходя из того какая выбрана
целевая таблица на этапе 2
- пятый этап появляется только тогда когда поставлена галочка на первом этапе в чекбоксе `Со словарем`. Данный этап предназначен
для настройки загрузки данных из словарной таблицы. Если нажать правую кнопку то появится контекстное меню добавления или удаления поля.
А также, если развернуть настройки поля и выбрать раздел `Имя поля в источнике` то также появится контекстное меню добавления или
удаления поля. Если же углубиться дальше и развернуть раздел `Имя поля в источнике` то выбрав раздел `Замена` и нажав правую
кнопку то также повяится контекстное меню добавления или удаления данного поля. Данное контекстное меню также доступно и в разделе
`Dictionary`
- На последнем шестом этапе предлагается ознакомиться со сформированным файлом конфигурации. Если нажать на кнопку окончания
загрузки то будет предложено написать имя нового файла конфигурации. После успешного создания файла конфигурации будет
выведено сообщение внизу окна.

В разделе меню `File` находятся следующие разделы меню

- Preferences 

- Open 

- Close Project 

- Save

- Save as...

- Exit

`Preferences` показывается раздел настроек подключения к базе данных а также имена файла источника и файла сравнения. После 
изменения значений в полях меню, необходимо нажимать кнопку `Save` для того чтобы изменения вступили в силу перед закрытием окна, а
так же нужно нажимать `File/Save` или `File/Save as...` для того чтобы перезаписать файл конфигруации с внесенными изменениями.

`Open` предназначен для открытия файла конфигурации

`Close Project ` нажав на данный раздел меню, вы закроете открытый в данный момент файл конфигурации. Файл закрывается
автоматически при открытии нового файла конфигурации

`Save` этот раздел предначначен для сохранения под текущим именем файла конфигурации

`Save as...` этот раздел предназначен для сохранения файла конфигурации под новым именем 

`Exit` нажав на этот раздел вы выйдите из программы

 [:arrow_up:Оглавление](#Оглавление)
## Создание файлов конфигурации загрузки данных

Теперь посмотрим на практике как выглядит создание файлов конфигурации.
Создадим файл конфигурации для таблицы `Table_1`

<image src="readme/create/create_table_1.gif">

Обратите внимание то, что для строковых полей в источнике был выбран тип `String` а для поля типа даты был выбран тип 
`Date`. А также то, что для поля в приемнике `id` было выбрано в настройках полей приемника занчение `Автоинкремент` так как
это поле берется не из источника данных а формируется автоматически в базе данных.

Далее создадим файл конфигурации для загрузки таблицы `Table_2`

<image src="readme/create/Table_2.gif">

А теперь создадим файл конфигурации для загрузки таблицы `Table`

<image src="readme/create/Table.gif">

В данном примере было показано как настраивать загрузку внешних ключей из словарной таблицы. В пятом коне мастера создания
конфигураций было указано то, что какому полю в целевой таблице соответствует поле из присоединенной таблицы. Поле `Индекс в целевой таблице`
это имя поля в таблице `Table` а поле `Индекс в словаре` это имя поля в словарной таблице, которое выбирается в поле `Таблица словаря`
В полях `Имя поля в источнике` выбираются поля из источника, которые соответствуют полям в соответствующей словарной таблице. В разделе `Имя поля в базе данных`
выбирается какому полю в базе данных соответствует данное поле из источника. Это нужно для того, чтобы система могла определить
какой строке из источника какой `id` в базе данных соответствует.

 [:arrow_up:Оглавление](#Оглавление)
## Загрузка данных

Загрузка таблицы `Table_1` На ее примере покажем как осуществляется тестирование конфигурации загрузки. Данное тестирование
рекомендуется делать перед каждой загрузкой данных 

<image src="readme/Load/table1_test.gif">

В окне `Debug` в режиме тестирования можно увидеть какие запросы будут сформированы к базе данных. Это нужно для того чтобы
осуществлять контроль качества загрузки и можно было понять какие данные будут грузиться. В окне `Log` можно увидеть общий ход
выполнения программы.

Далее выполним загрузку данных в таблицу `Table_1`

<image src="readme/Load/table1_load.gif">

Если будут выялены какие-либо ошибки при загрузке данных, то они появятся в окне `Debug`. Если будут какие-либо критические
ошибки то появится всплывающее окно с указанием ошибки.

Далее выполним загрузку в таблицу `Table_2` 

<image src="readme/Load/table2.gif">

Выполним финальную загрузку в таблицу `Table` 

<image src="readme/Load/Table.gif">

Если осуществлялось изменение данных в источнике, в то время как этот источник был загружен в системе загрузки, то рекомендуется
перезапустить программу загрузки данных для последующей загрузки измененных данных.

 [:arrow_up:Оглавление](#Оглавление)
## Создание конфигурации сверки файлов и его запуск

Сверка файлов предназначена для того, чтобы сравнить данные в полях двух файлов Excel источников. Сверка соуществляется на предмет
соответствия друг другу данных в полях файлов, а также на уникальность данных в поле, если это отмечено в настройках полей источника. 
Также идет проверка на отсутствие пустых ячеек в поле, если это отмечено в настройках полей источника.

<image src="readme/create/create_compare.gif">

сверка осуществляется только при наличии подключения к базе данных и настроенному файлу конфигурации, как это показано выше.

Запустим данный файл конфигурации

<image src="readme/Load/compare.gif">

Как мы видим, осуществлено два варианта сверки файлов: с отмеченным чекбоксом `Оба` и без. В чем отличие. Если мы озанкомимся
с представленными выше скриншотами файлов источников, то мы видим то, что в файле `Book.xlx` если все данные из файла источника а также
дополнительные значения. Так вот: поле `Оба` говорит о том, что сравнение данных в полях будет осуществляться как первого во втором так и 
второго в первом. А если это поле выключено, то сверка будет осуществляться на предмет наличия данных файла источника в файле сверки.
Мы наблюдаем то,что когда поле `Оба` выключено то ошибка не возникает, так как те данные которые есть в файле источнике
 есть в файле `Book.xlx`. Но когда мы включаем это поле, возникает ошибка, так как
в файле `Book.xlx` есть данные, которых нет в файле источнике.

 [:arrow_up:Оглавление](#Оглавление)
## Создание конфигурации обновления данных 

Создадим файл конфигурации, предназначенный для обновления значений в базе данных

<image src="readme/edit/update_create.gif">

Как мы видим, что для создания файла обновления достаточно выбрать значение `update` в меню настроек базы данных. А также,
`нужно обязательно выбрать по какому полю будет осуществляться поиск строки которую нужно обновить`. Для этого в разделе
настроек полей в базе данных нужно поставить галочку в нужном поле в чекбоксе `Участвует в UPDATE условии`.

Выполним загрузку этого файла конфигурации, предварительно изменив данные в поле dict_1_1 в источнике. 
Сначала протестируем, чтобы увидеть какие запросы формируются:

<image src="readme/Load/table1_test_update.gif">

Как мы видим из лога тестирования, в условие `WHERE` попали данные из поля которое мы отметили.
Теперь осуществим загрузку данных:

<image src="readme/Load/table1_load_update.gif">

 [:arrow_up:Оглавление](#Оглавление)
## Закрытие проекта

<image src="readme/close/close_config.gif">

Об успешном закрытии проекта можно понять по отсутствию имени проекта в имени окна в осном окне программы.
